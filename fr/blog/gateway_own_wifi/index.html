<!doctype html><html lang=fr itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.svg><title>Mettre en place une passerelle pour contourner les restrictions de nombre d’appareils sur un réseau public - Alestrio
</title><meta name=description content="Salut à tous ! Si vous avez déjà utilisé un réseau public, vous savez certainement de quoi je vais parler. Les réseaux publics sont souvent derrière ce que l’on appelle un “Portail Captif”, il s’agit souvent d’une page de connexion sur laquelle il faut se connecter afin d’accéder à Internet. Ces réseaux sont aussi souvent limités en nombre d’appareils que vous pouvez connecter avec votre compte. Eh bien dans cet article, nous allons mettre en place une passerelle, afin d’accéder au réseau public avec plusieurs appareils, à travers une seule interface."><meta name=author content="Alexis LEBEL"><meta name=generator content="Hugo 0.129.0"><link rel=stylesheet href="https://www.alexislebel.fr/css/styles.min.bc90fa55d1ba6b52213b3c8bedc8b3ffc8578d91dcd3927072f8e1c7e7cc77cf.css"><meta property="og:url" content="https://www.alexislebel.fr/fr/blog/gateway_own_wifi/"><meta property="og:site_name" content="Alestrio"><meta property="og:title" content="Mettre en place une passerelle pour contourner les restrictions de nombre d’appareils sur un réseau public"><meta property="og:description" content="Salut à tous ! Si vous avez déjà utilisé un réseau public, vous savez certainement de quoi je vais parler. Les réseaux publics sont souvent derrière ce que l’on appelle un “Portail Captif”, il s’agit souvent d’une page de connexion sur laquelle il faut se connecter afin d’accéder à Internet. Ces réseaux sont aussi souvent limités en nombre d’appareils que vous pouvez connecter avec votre compte. Eh bien dans cet article, nous allons mettre en place une passerelle, afin d’accéder au réseau public avec plusieurs appareils, à travers une seule interface."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-01T00:00:00+00:00"><meta property="article:tag" content="IoT"><meta property="article:tag" content="Wifi"><meta property="article:tag" content="Gateway"><meta property="article:tag" content="Privacy"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mettre en place une passerelle pour contourner les restrictions de nombre d’appareils sur un réseau public"><meta name=twitter:description content="Salut à tous ! Si vous avez déjà utilisé un réseau public, vous savez certainement de quoi je vais parler. Les réseaux publics sont souvent derrière ce que l’on appelle un “Portail Captif”, il s’agit souvent d’une page de connexion sur laquelle il faut se connecter afin d’accéder à Internet. Ces réseaux sont aussi souvent limités en nombre d’appareils que vous pouvez connecter avec votre compte. Eh bien dans cet article, nous allons mettre en place une passerelle, afin d’accéder au réseau public avec plusieurs appareils, à travers une seule interface."><meta itemprop=name content="Mettre en place une passerelle pour contourner les restrictions de nombre d’appareils sur un réseau public"><meta itemprop=description content="Salut à tous ! Si vous avez déjà utilisé un réseau public, vous savez certainement de quoi je vais parler. Les réseaux publics sont souvent derrière ce que l’on appelle un “Portail Captif”, il s’agit souvent d’une page de connexion sur laquelle il faut se connecter afin d’accéder à Internet. Ces réseaux sont aussi souvent limités en nombre d’appareils que vous pouvez connecter avec votre compte. Eh bien dans cet article, nous allons mettre en place une passerelle, afin d’accéder au réseau public avec plusieurs appareils, à travers une seule interface."><meta itemprop=datePublished content="2020-12-01T00:00:00+00:00"><meta itemprop=dateModified content="2020-12-01T00:00:00+00:00"><meta itemprop=wordCount content="1074"><meta itemprop=keywords content="IoT,Wifi,Gateway,Privacy"><meta name=lang content="fr"></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://www.alexislebel.fr/fr/ class="capitalize font-extrabold text-2xl">Alestrio
</a><button class="mobile-menu-button md:hidden"><svg width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=/fr/blog>Blog</a></li><li><a href=/fr/page/about/>A propos de moi</a></li><li><a href=/fr/page/legal>Mentions légales</a></li><li class="flex items-center"><svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><line x1="3.6" y1="9" x2="20.4" y2="9"/><line x1="3.6" y1="15" x2="20.4" y2="15"/><path d="M11.5 3a17 17 0 000 18"/><path d="M12.5 3a17 17 0 010 18"/></svg>
<a href=/en/ lang=en>English</a></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><div class="relative max-w-5xl mx-auto px-4"><img src="https://images.unsplash.com/photo-1554098415-4052459dc340?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1526&amp;q=80" class="rounded-lg shadow-sm w-full object-contain"><div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">01. Décembre 2020</div></div><article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4"><h1 class="text-2xl font-bold mb-2">Mettre en place une passerelle pour contourner les restrictions de nombre d’appareils sur un réseau public</h1><h5 class="text-sm flex items-center flex-wrap"><svg class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><rect x="8" y="15" width="2" height="2"/></svg>
Posté le
01. Décembre 2020
&nbsp;&bull;&nbsp;
<svg class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
6&nbsp;minutes
&nbsp;&bull;
<svg class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
1074&nbsp;mots</h5><p>Salut à tous ! Si vous avez déjà utilisé un réseau public, vous savez certainement de quoi je vais parler. Les réseaux publics sont souvent derrière ce que l’on appelle un “Portail Captif”, il s’agit souvent d’une page de connexion sur laquelle il faut se connecter afin d’accéder à Internet. Ces réseaux sont aussi souvent limités en nombre d’appareils que vous pouvez connecter avec votre compte. Eh bien dans cet article, nous allons mettre en place une passerelle, afin d’accéder au réseau public avec plusieurs appareils, à travers une seule interface.</p><h1 id=le-matériel>Le matériel</h1><p>Tout d’abord, vous aurez besoin du serveur qui gérera la passerelle. Je vous conseille de prendre un ordinateur monocarte, par exemple un Raspberry Pi. Personnellement, j’utiliserai un Orange Pi one, qui a l’avantage d’être bon marché, et d’avoir un port Ethernet et un port USB : on a pas besoin de plus.</p><p>Vous aurez aussi besoin d’une carte réseau WiFi USB, d’un petit câble Ethernet et d’un routeur. Ici, j’utiliserai le RTAC51U de chez Asus, car c’est un routeur que j’avais à disposition lorsque je faisait ce test.</p><p>Et voilà, rien de plus ! Passons à la pratique !</p><h1 id=se-connecter-à-la-passerelle>Se connecter à la passerelle</h1><p>Afin de configurer la passerelle, connectez-là d’abord à un port local de votre routeur, afin d’y accéder en SSH. Sur les Raspberry Pi, il faut au préalable l’activer en branchant un écran et un clavier. Sur tout autre matériel tournant sous Armbian, le SSH est activé par défaut. Les identifiants par défaut sont root/1234 . Je vous conseille vivement de les changer à la première utilisation.</p><h1 id=configuration-de-la-passerelle>Configuration de la passerelle</h1><p>Dans cette partie, je prendrai comme base, le tutoriel qui se trouve ici, mais adapté à notre cas.</p><p>Tout d’abord, nous allons nous connecter au WiFI. Il vous faudra donc faire la commande suivante :</p><p><code>nmtui</code></p><p><img alt=image src=/images/2020/11/image.png></p><p>Vous vous retrouverez avec cette “fenêtre”. Il faut ensuite aller dans “Activer une connexion” puis vous connecter au réseau public de votre choix.</p><p>Ensuite, nous allons avoir besoin du nom de nos deux interfaces. Vous pouvez ainsi faire la commande suivante, et relever les interfaces qui ont un nom qui commence par “eth”, “ens”, “wlan”, ou encore “wlx”, cela dépend des systèmes.</p><p><code>ifconfig</code></p><p>Dans la suite de ce guide, nous prendrons comme base les interfaces eth0 et wlan0.</p><p>Nous allons ensuite devoir configurer un serveur dhcp, que nous allons installer :</p><pre tabindex=0><code>sudo apt-get update
sudo apt-get upgrade -y
sudo apt-get install isc-dhcp-server iptables-persistent -y
</code></pre><p>Ensuite nous désactivons de DHCP pour l’interface Filaire :</p><p><code>sudo nano /etc/dhcpcd.conf</code></p><p>En ajoutant la ligne :</p><p><code>denyinterfaces eth0</code></p><p>Et en spécifiant une nouvelle adresse pour cette interface :</p><p><code>sudo nano /etc/network/interfaces</code></p><pre tabindex=0><code>auto eth0
allow-hotplug eth0
iface eth0 inet static
    address 192.168.2.1
    netmask 255.255.255.0
    network 192.168.2.0
    broadcast 192.168.2.255
</code></pre><p>Maintenant il faut configurer le serveur DHCP, ce serveur n’aura pour utilité que de donner une adresse IP locale à notre routeur :</p><pre tabindex=0><code>sudo cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.bak \
sudo nano /etc/dhcp/dhcpd.conf
</code></pre><p>Nous allons modifier le fichier afin d’avoir les lignes suivantes :</p><pre tabindex=0><code># Sample /etc/dhcpd.conf 
# (add your comments here)
default-lease-time 600;
max-lease-time 7200;
option subnet-mask 255.255.255.0;
option broadcast-address 192.168.1.255;
option routers 192.168.1.254;
option domain-name-servers 192.168.1.1, 192.168.1.2;
option domain-name &#34;undomaine.peuimporte&#34;;
option ntp-servers 192.168.1.254;

subnet 192.168.2.0 netmask 255.255.255.0 {
   range 192.168.2.2 192.168.2.50;
   option subnet-mask 255.255.255.0;
   option routers 192.168.2.1;
   option broadcast-address 192.168.2.255;
   default-lease-time 600;
   max-lease-time 7200;
} 
</code></pre><p>Cela permet de créer un réseau dont l’adresse de passerelle est <code>192.168.2.1</code>, et dont les clients auront les adresses de <code>192.168.2.2</code> à <code>192.168.2.50</code> (ce qui est largement suffisant vu la tâche du serveur DHCP).</p><p>Enfin, il faut configurer le routage Filaire -> WiFi :</p><p>Nous allons d’abord activer cette fonction en allant dans le fichier <code>/etc/sysctl.conf</code></p><p><code>sudo nano /etc/sysctl.conf</code></p><p>Il faut ensuite dé-commenter ceci en enlevant le # :</p><p><code>net.ipv4.ip_forward=1</code></p><p>Puis activer les modifications :</p><p><code>sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"</code></p><p>Nous allons ensuite créer un script :</p><p><code>sudo nano iptablereset.sh</code></p><p>Dans lequel on va mettre</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ff79c6>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;Resetting the IP Tables&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>ipt</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;/sbin/iptables&#34;</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>## Failsafe - die if /sbin/iptables not found [ ! -x &#34;$ipt&#34; ] &amp;&amp; { echo &#34;$0: \&#34;${ipt}\&#34; command not found.&#34;; exit 1; }</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -P INPUT ACCEPT
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -P FORWARD ACCEPT
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -P OUTPUT ACCEPT
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -F
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -X
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t nat -F
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t nat -X
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t mangle -F
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t mangle -X
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t raw -F
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$ipt</span> -t raw -X
</span></span></code></pre></div><p>On enregistre…</p><p><code>sudo chmod +x iptablereset.sh</code></p><p>…on le rend exécutable…</p><p><code>sudo ./iptablereset.sh</code></p><p>… et on l’exécute !</p><p>Maintenant on va mettre nos nouvelle règles dans iptables, avec ces commandes :</p><p><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE</code></p><p><code>sudo iptables -A FORWARD -i wlan0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT</code></p><p><code>sudo iptables -A FORWARD -i eth0 -o wlan0 -j ACCEPT</code></p><p>On sauve :</p><p><code>sudo sh -c "iptables-save > /etc/iptables.ipv4.nat"</code></p><p>Puis on applique ces règles au démarrage. Pour ce faire, on modifie le rc.local :</p><p><code>sudo nano /etc/rc.local</code></p><p>Puis on rajoute cette ligne avant le exit 0</p><p><code>iptables-restore &lt; /etc/iptables.ipv4.nat</code></p><p>Et voilà, votre passerelle est configurée pour redistribuer le réseau WiFI via le réseau filaire !</p><h1 id=configuration-du-routeur>Configuration du routeur</h1><p>Nous allons maintenant configurer le routeur. A partir de maintenant, vous pouvez brancher le câble réseau de la passerelle au port WAN ou Internet du routeur. Il devrais récupérer son adresse et être fonctionnel. Cependant, nous allons faire quelques modifications dans sa configuration. par conséquent, il faut se connecter à son interface d’administration. Par défaut, son adresse est <code>192.168.1.1</code></p><p>Tout d’abord, afin que les différents réseaux ne rentrent pas en conflit, nous allons changer les paramètres IP. Pour ma part cela ressemble à ça :</p><p><img alt=image-1 src=/images/2020/11/image-1.png>
<img alt=image-2 src=/images/2020/11/image-2.png></p><p>J’utilise ici un réseau <code>10.6.0.0</code> avec un masque en <code>255.255.255.0</code> qui me permet de connecter 253 machines.</p><p>Et pour le reste, c’est à votre guise (mot de passe wifi, points d’accès, dual WAN…)</p><h1 id=conclusion>Conclusion</h1><p>Voilà, vous savez maintenant comment faire de la translation de connexion d’une interface à une autre, mais vous avez aussi votre propre réseau privé, dans un réseau public. Maintenant, pour des soucis de sécurité, je vous conseille vivement d’utiliser un VPN, puisque toutes les données vont quand même passer sur le réseau public. Bien que pratiquement tout internet est maintenant en HTTPS, certaines techniques notamment le Man In the Middle, permettent quand même d’intercepter du traffic non chiffré. Le routeur que j’utilise permet de mettre un VPN qui est utilisé de manière transparente pour tous les appareils connectés, ce qui n’est pas forcément une mauvaise idée si vous voulez mon avis !</p><p>Bonne bidouille !</p></article><div class="bg-blue-200 dark:bg-gray-900"><div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center"><div><div class="text-2xl font-bold mb-2">Follow me</div><p class=opacity-60>Passion-driven engineering student</p></div><ul class="flex justify-center gap-x-3 flex-wrap gap-y-2"></ul></div></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">Copyright © 2025 - Alexis LEBEL · All rights reserved
</span><span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>